#!/usr/bin/env bash
STEEL_PATH="../steel/"


train_single()
{
    SAVE_IMAGES=$1;shift
    DATASET=$1; shift
    DATASET_PATH=$1; shift
    RUN_NAME=$1; shift
    RESULTS_PATH=$1; shift
    DILATE=$1; shift
    TRAIN_NUM=$1; shift
    NUM_SEGMENTED=$1; shift

    EPOCHS=$1; shift
    LEARNING_RATE=$1; shift
    DELTA_CLS_LOSS=$1; shift
    BATCH_SIZE=$1; shift
    WEIGHTED_SEG_LOSS=$1; shift
    WEIGHTED_SEG_LOSS_P=$1; shift
    WEIGHTED_SEG_LOSS_MAX=$1; shift
    DYN_BALANCED_LOSS=$1; shift
    GRADIENT_ADJUSTMENT=$1; shift
    FREQUENCY_SAMPLING=$1; shift

    GPU=$1; shift


    RUN_ARGS="--SAVE_IMAGES=$SAVE_IMAGES --DATASET_PATH=$DATASET_PATH --DILATE=$DILATE --NUM_SEGMENTED=$NUM_SEGMENTED --TRAIN_NUM=$TRAIN_NUM --RUN_NAME=$RUN_NAME --RESULTS_PATH=$RESULTS_PATH --DATASET=$DATASET --EPOCHS=$EPOCHS --LEARNING_RATE=$LEARNING_RATE --DELTA_CLS_LOSS=$DELTA_CLS_LOSS --BATCH_SIZE=$BATCH_SIZE --WEIGHTED_SEG_LOSS=$WEIGHTED_SEG_LOSS --WEIGHTED_SEG_LOSS_P=$WEIGHTED_SEG_LOSS_P --WEIGHTED_SEG_LOSS_MAX=$WEIGHTED_SEG_LOSS_MAX --DYN_BALANCED_LOSS=$DYN_BALANCED_LOSS --GRADIENT_ADJUSTMENT=$GRADIENT_ADJUSTMENT --FREQUENCY_SAMPLING=$FREQUENCY_SAMPLING --VALIDATE=True"

    LOG_REDIRECT=$RESULTS_PATH/$DATASET/$RUN_NAME/training_log.txt

    mkdir -p $RESULTS_PATH/$DATASET/$RUN_NAME/ && python -u train_net.py --GPU=$GPU $RUN_ARGS | /usr/bin/tee $LOG_REDIRECT


}

